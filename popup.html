<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <style>
        body {
            width: 100%;
            min-width: 300px;
            max-width: 500px;
            padding: 0;
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f5f5;
        }
        
        .header {
            background: #2196F3;
            color: white;
            padding: 15px;
            text-align: center;
            font-weight: bold;
        }
        
        .timer-container {
            padding: 15px;
            display: block !important;
            visibility: visible !important;
        }
        
        .timer-tile {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: all 0.2s ease;
            border-left: 4px solid #ddd;
        }
        
        .timer-tile.active {
            border-left-color: #4CAF50;
            background: #f8fff8;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.02); }
            100% { transform: scale(1); }
        }
        
        .timer-tile.client-1.active { border-left-color: #FF5722; }
        .timer-tile.client-2.active { border-left-color: #2196F3; }
        .timer-tile.client-3.active { border-left-color: #4CAF50; }
        
        .timer-info {
            flex-grow: 1;
        }
        
        .timer-controls {
            display: flex;
            gap: 8px;
            align-items: center;
        }
        
        .config-timer-btn {
            background: #f5f5f5;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.2s;
            min-width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .config-timer-btn:hover {
            background: #e0e0e0;
            border-color: #bbb;
        }
        
        .client-name {
            font-weight: bold;
            font-size: 16px;
            margin-bottom: 5px;
        }
        
        .timer-display {
            font-size: 24px;
            font-weight: bold;
            color: #333;
            font-family: 'Courier New', monospace;
        }
        
        .start-btn {
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 6px;
            padding: 12px 20px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: background 0.2s;
            min-width: 80px;
        }
        
        .start-btn:hover {
            background: #45a049;
        }
        
        .start-btn.stop {
            background: #f44336;
        }
        
        .start-btn.stop:hover {
            background: #da190b;
        }
        
        .footer {
            background: white;
            padding: 15px;
            border-top: 1px solid #ddd;
            text-align: center;
        }
        
        .total-time {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .sync-status {
            font-size: 12px;
            color: #666;
        }
        
        .sync-status.connected {
            color: #4CAF50;
        }
        
        .sync-status.error {
            color: #f44336;
        }
        
        .setup-button {
            background: #2196F3;
            color: white;
            border: none;
            border-radius: 6px;
            padding: 10px 20px;
            margin: 10px 5px;
            cursor: pointer;
            font-size: 14px;
        }
        
        .setup-container {
            text-align: center;
            padding: 20px;
        }
        
        .hidden {
            display: none;
        }
        
        .shortcut-hint {
            font-size: 11px;
            color: #999;
            margin-top: 5px;
        }

        /* Modal Styles */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            border-radius: 8px;
            width: 450px;
            max-width: 90vw;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        .modal-header {
            padding: 20px 20px 10px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h3 {
            margin: 0;
            color: #333;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            color: #999;
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .close-btn:hover {
            color: #666;
        }

        .modal-body {
            padding: 20px;
        }

        .modal-footer {
            padding: 10px 20px 20px;
            text-align: right;
        }

        .modal-footer button {
            margin-left: 10px;
        }

        /* Configuration Styles */
        .timer-config {
            background: #f9f9f9;
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 15px;
            border: 2px solid transparent;
        }

        .timer-config h4 {
            margin: 0 0 15px;
            color: #333;
        }

        .config-row {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        .config-row label {
            width: 80px;
            font-weight: bold;
            color: #555;
        }

        .project-select, .task-select {
            flex: 1;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }

        .project-select:focus, .task-select:focus {
            outline: none;
            border-color: #2196F3;
        }

        input[type="color"] {
            width: 50px;
            height: 30px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .config-status {
            font-size: 12px;
            margin-top: 5px;
            padding: 5px 8px;
            border-radius: 4px;
        }

        .config-status.success {
            background: #e8f5e8;
            color: #2e7d2e;
            border: 1px solid #a3d3a3;
        }

        .config-status.error {
            background: #ffe8e8;
            color: #d32f2f;
            border: 1px solid #ffb3b3;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #666;
        }

        .error {
            background: #ffe8e8;
            color: #d32f2f;
            border: 1px solid #ffb3b3;
            border-radius: 4px;
            padding: 10px;
            margin: 10px 0;
        }

        #task-info {
            background: #f0f8ff;
            border-radius: 4px;
            padding: 10px;
            margin-bottom: 15px;
        }

        #task-comment {
            width: 100%;
            height: 60px;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            resize: vertical;
            font-family: inherit;
        }
    </style>
</head>
<body>
    <div class="header">
        <div>Time Tracker</div>
    </div>
    
    <div id="setup-container" class="setup-container hidden">
        <h3>Setup FreeAgent</h3>
        <p>Connect to FreeAgent to sync your time entries</p>
        <button id="connect-btn" class="setup-button">Connect FreeAgent</button>
        <button id="skip-setup" class="setup-button" style="background: #666;">Skip for Now</button>
    </div>
    
    <div id="main-container" class="timer-container" style="display: block; visibility: visible;">
        <div class="timer-tile client-1" data-timer="1">
            <div class="timer-info">
                <div class="client-name" id="client-1-name">Client 1</div>
                <div class="timer-display" id="timer-1-display">00:00:00</div>
                <div class="shortcut-hint">Alt+1</div>
            </div>
            <div class="timer-controls">
                <button class="config-timer-btn" id="config-timer-1" data-timer="1" title="Configure Timer 1">⚙️</button>
                <button class="start-btn" id="timer-1-btn" data-timer="1">Start</button>
            </div>
        </div>
        
        <div class="timer-tile client-2" data-timer="2">
            <div class="timer-info">
                <div class="client-name" id="client-2-name">Client 2</div>
                <div class="timer-display" id="timer-2-display">00:00:00</div>
                <div class="shortcut-hint">Alt+2</div>
            </div>
            <div class="timer-controls">
                <button class="config-timer-btn" id="config-timer-2" data-timer="2" title="Configure Timer 2">⚙️</button>
                <button class="start-btn" id="timer-2-btn" data-timer="2">Start</button>
            </div>
        </div>
        
        <div class="timer-tile client-3" data-timer="3">
            <div class="timer-info">
                <div class="client-name" id="client-3-name">Client 3</div>
                <div class="timer-display" id="timer-3-display">00:00:00</div>
                <div class="shortcut-hint">Alt+3</div>
            </div>
            <div class="timer-controls">
                <button class="config-timer-btn" id="config-timer-3" data-timer="3" title="Configure Timer 3">⚙️</button>
                <button class="start-btn" id="timer-3-btn" data-timer="3">Start</button>
            </div>
        </div>
    </div>
    
    <div class="footer">
        <div class="total-time">
            Today: <span id="total-time">0h 0m</span>
        </div>
        <div class="sync-status" id="sync-status">
            Not connected to FreeAgent
        </div>
        <button id="setup-btn" class="setup-button" style="font-size: 12px; padding: 5px 10px;">
            Setup FreeAgent
        </button>
    </div>

    <!-- Configuration Modal -->
    <div id="config-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="config-modal-title">Configure Timer</h3>
                <button id="close-config" class="close-btn">&times;</button>
            </div>
            <div class="modal-body">
                <div id="loading-projects" class="loading">Loading projects...</div>
                <div id="config-error" class="error hidden"></div>
                
                <div id="timer-config-single" class="hidden">
                    <div class="timer-config">
                        <h4 id="config-timer-name">Timer 1</h4>
                        <div class="config-row">
                            <label>Project:</label>
                            <select id="project-select-current" class="project-select">
                                <option value="">Select Project...</option>
                            </select>
                        </div>
                        <div class="config-row">
                            <label>Color:</label>
                            <input type="color" id="color-select-current" value="#FF5722">
                        </div>
                        <div class="config-status" id="config-status-current"></div>
                    </div>
                </div>
                    </div>
            </div>
            <div class="modal-footer">
                <button id="save-config" class="setup-button">Save Configuration</button>
                <button id="cancel-config" class="setup-button" style="background: #666;">Cancel</button>
            </div>
        </div>
    }
                </div>
            </div>
            <div class="modal-footer">
                <button id="save-config" class="setup-button">Save Configuration</button>
                <button id="cancel-config" class="setup-button" style="background: #666;">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Task Selection Modal -->
    <div id="task-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Select Task & Create Timeslip</h3>
                <button id="close-task" class="close-btn">&times;</button>
            </div>
            <div class="modal-body">
                <div id="task-info">
                    <p><strong>Project:</strong> <span id="task-project-name"></span></p>
                    <p><strong>Time Logged:</strong> <span id="task-time-logged"></span></p>
                </div>
                
                <div class="config-row">
                    <label>Task:</label>
                    <select id="task-select" class="task-select">
                        <option value="">Loading tasks...</option>
                    </select>
                </div>
                
                <div class="config-row">
                    <label>Comment (optional):</label>
                    <textarea id="task-comment" placeholder="Describe what you worked on..."></textarea>
                </div>
                
                <div id="task-error" class="error hidden"></div>
            </div>
            <div class="modal-footer">
                <button id="create-timeslip" class="setup-button">Create Timeslip</button>
                <button id="cancel-task" class="setup-button" style="background: #666;">Cancel</button>
            </div>
        </div>
    </div>
    
    <script src="auth.js"></script>
    <script src="freeagent-api.js"></script>
    <script src="popup.js"></script>
</body>
</html>